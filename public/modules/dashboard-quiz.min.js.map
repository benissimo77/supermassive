{"version":3,"file":"dashboard-quiz.min.js","sources":["../../src/host/FileDropzone.js","../../src/host/dashboard-quiz.js"],"sourcesContent":["// FileDropzone.js\r\nexport class FileDropzone {\r\n  constructor(options) {\r\n    this.options = {\r\n      element: null,              // DOM element or selector\r\n      accept: '*/*',              // File types to accept\r\n      multiple: false,            // Allow multiple files\r\n      maxSize: 10 * 1024 * 1024,  // Default max size (10MB)\r\n      onDrop: null,               // Callback when files are dropped\r\n      onError: null,              // Callback when an error occurs\r\n      hoverClass: 'dropzone-hover',\r\n      ...options\r\n    };\r\n    \r\n    this.element = typeof this.options.element === 'string' \r\n      ? document.querySelector(this.options.element)\r\n      : this.options.element;\r\n      \r\n    if (!this.element) {\r\n      console.error('Dropzone element not found');\r\n      return;\r\n    }\r\n    \r\n    this.fileInput = this.element.querySelector('input[type=\"file\"]');\r\n    if (!this.fileInput) {\r\n      this.fileInput = document.createElement('input');\r\n      this.fileInput.type = 'file';\r\n      this.fileInput.style.display = 'none';\r\n      this.element.appendChild(this.fileInput);\r\n    }\r\n    \r\n    this.fileInput.accept = this.options.accept;\r\n    this.fileInput.multiple = this.options.multiple;\r\n    \r\n    this.init();\r\n  }\r\n  \r\n  init() {\r\n    // Add click handler to open file picker\r\n    this.element.addEventListener('click', (e) => {\r\n      if (e.target !== this.fileInput) {\r\n        this.fileInput.click();\r\n      }\r\n    });\r\n    \r\n    // Handle file selection via input\r\n    this.fileInput.addEventListener('change', (e) => {\r\n      this.handleFiles(this.fileInput.files);\r\n    });\r\n    \r\n    // Handle drag events\r\n    this.element.addEventListener('dragover', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.element.classList.add(this.options.hoverClass);\r\n    });\r\n    \r\n    this.element.addEventListener('dragleave', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.element.classList.remove(this.options.hoverClass);\r\n    });\r\n    \r\n    this.element.addEventListener('drop', (e) => {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      this.element.classList.remove(this.options.hoverClass);\r\n      \r\n      if (e.dataTransfer.files.length > 0) {\r\n        this.handleFiles(e.dataTransfer.files);\r\n      }\r\n    });\r\n  }\r\n  \r\n  handleFiles(files) {\r\n    if (files.length === 0) return;\r\n    \r\n    // Validate files\r\n    const validFiles = Array.from(files).filter(file => {\r\n      // Check file size\r\n      if (file.size > this.options.maxSize) {\r\n        this.triggerError(`File too large: ${file.name}`);\r\n        return false;\r\n      }\r\n      \r\n      // Check file type if accept is specified\r\n      if (this.options.accept !== '*/*') {\r\n        const acceptTypes = this.options.accept.split(',').map(type => type.trim());\r\n        const fileType = file.type;\r\n        const fileExtension = '.' + file.name.split('.').pop();\r\n        \r\n        // Check if file type or extension matches accept types\r\n        const isValid = acceptTypes.some(type => {\r\n          if (type.startsWith('.')) {\r\n            return fileExtension.toLowerCase() === type.toLowerCase();\r\n          } else if (type.endsWith('/*')) {\r\n            const typeGroup = type.split('/')[0];\r\n            return fileType.startsWith(typeGroup + '/');\r\n          } else {\r\n            return fileType === type;\r\n          }\r\n        });\r\n        \r\n        if (!isValid) {\r\n          this.triggerError(`File type not accepted: ${file.name}`);\r\n          return false;\r\n        }\r\n      }\r\n      \r\n      return true;\r\n    });\r\n    \r\n    if (validFiles.length > 0) {\r\n      if (this.options.onDrop) {\r\n        this.options.onDrop(validFiles, this.element);\r\n      }\r\n    }\r\n    \r\n    // Reset file input\r\n    this.fileInput.value = '';\r\n  }\r\n  \r\n  triggerError(message) {\r\n    if (this.options.onError) {\r\n      this.options.onError(message);\r\n    } else {\r\n      console.error(message);\r\n    }\r\n  }\r\n}","import { FileDropzone } from './FileDropzone.js';\r\n\r\nexport function initDashboardQuiz() {\r\n\r\n\tconst createQuizButton = document.getElementById('create-quiz');\r\n\tcreateQuizButton.addEventListener('click', createQuiz);\r\n\r\n\t// Initialize import quiz dropzone\r\n\tconst importQuizDropzone = new FileDropzone({\r\n\t\telement: '#import-quiz-dropzone',\r\n\t\taccept: '.json,application/json',\r\n\t\tonDrop: (files) => {\r\n\t\t\tif (files.length > 0) {\r\n\t\t\t\timportQuizFromFile(files[0]);\r\n\t\t\t}\r\n\t\t},\r\n\t\tonError: (error) => {\r\n\t\t\talert(error);\r\n\t\t}\r\n\t});\r\n\r\n\tfetchQuizzes();\r\n\r\n\tasync function fetchQuizzes() {\r\n\t\ttry {\r\n\t\t\tconst response = await fetch('/api/quiz', {\r\n\t\t\t\tmethod: 'GET',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\r\n\t\t\t});\r\n\t\t\tconst result = await response.json();\r\n\t\t\tif (!result.success) throw new Error(result.message || 'Failed to fetch quizzes');\r\n\t\t\t\r\n\t\t\tcreateQuizList(result.data);\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error fetching quizzes:', error);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction createQuizList(quizzes) {\r\n\t\tconst quizItemTemplate = document.getElementById('quiz-item-template');\r\n\t\tconst quizList = document.getElementById('quiz-items');\r\n\t\tquizList.innerHTML = '';\r\n\t\t\r\n\t\tif (quizzes.length === 0) {\r\n\t\t\tquizList.innerHTML = '<tr><td colspan=\"2\" class=\"no-quizzes\">No quizzes found. Create one to get started!</td></tr>';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tquizzes.forEach(quiz => {\r\n\t\t\tconst quizItemElement = quizItemTemplate.content.cloneNode(true);\r\n\t\t\tconst row = quizItemElement.querySelector('tr');\r\n\t\t\t\r\n\t\t\tquizItemElement.querySelector('.quiz-item-title').textContent = quiz.title;\r\n\t\t\t\r\n\t\t\tquizItemElement.querySelector('.delete-quiz-item').addEventListener('click', (e) => {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\tif (confirm(`Are you sure you want to delete \"${quiz.title}\"?`)) {\r\n\t\t\t\t\tdeleteQuiz(quiz._id);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\t// Make the entire row clickable to edit\r\n\t\t\trow.style.cursor = 'pointer';\r\n\t\t\trow.addEventListener('click', () => gotoQuizEdit(quiz));\r\n\r\n\t\t\tconst errorIndicator = quizItemElement.querySelector('.error-indicator');\r\n\t\t\tif (quiz.validation && quiz.validation.length > 0) {\r\n\t\t\t\terrorIndicator.style.display = 'inline-flex';\r\n\t\t\t\terrorIndicator.title = `${quiz.validation.length} validation issues found`;\r\n\t\t\t} else {\r\n\t\t\t\terrorIndicator.style.display = 'none';\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tquizList.appendChild(quizItemElement);\r\n\t\t});\r\n\t}\r\n\r\n\tfunction createQuiz() {\r\n\t\tgotoQuizEdit({ title: 'New Quiz', description: '', rounds: [] });\r\n\t}\r\n\r\n\tasync function deleteQuiz(quizId) {\r\n\t\ttry {\r\n\t\t\tconst response = await fetch(`/api/quiz/${quizId}`, {\r\n\t\t\t\tmethod: 'DELETE',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json' }\r\n\t\t\t});\r\n\t\t\tconst result = await response.json();\r\n\t\t\tif (!result.success) throw new Error(result.message || 'Failed to delete quiz');\r\n\t\t\tfetchQuizzes();\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error deleting quiz:', error);\r\n\t\t\talert('Error deleting quiz: ' + error.message);\r\n\t\t}\r\n\t}\r\n\r\n\tfunction gotoQuizEdit(quiz) {\r\n\t\twindow.location.href = '/host/dashboard/quizedit.html' + (quiz && quiz._id ? `?id=${quiz._id}` : '');\r\n\t}\r\n\r\n\tasync function importQuizFromFile(file) {\r\n\t\talert(`Importing quiz from file: ${file.name}`);\r\n\t\tif (!file.name.endsWith('.json') && file.type !== 'application/json') {\r\n\t\t\talert('Please select a JSON file.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\ttry {\r\n\t\t\tconst text = await file.text();\r\n\t\t\tconst quizData = JSON.parse(text);\r\n\t\t\t\r\n\t\t\t// Remove _id to ensure it's treated as a new quiz\r\n\t\t\tdelete quizData._id;\r\n\r\n\t\t\tconst response = await fetch('/api/quiz/save', {\r\n\t\t\t\tmethod: 'POST',\r\n\t\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\t\tbody: JSON.stringify(quizData)\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tconst result = await response.json();\r\n\t\t\tif (result.success) {\r\n\t\t\t\talert('Quiz imported successfully!');\r\n\t\t\t\tfetchQuizzes();\r\n\t\t\t} else {\r\n\t\t\t\talert('Failed to import quiz: ' + (result.message || 'Unknown error'));\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Error importing quiz:', error);\r\n\t\t\talert('Error importing quiz. Please ensure it is a valid JSON file.');\r\n\t\t}\r\n\t}\r\n}\r\n"],"names":["FileDropzone","constructor","options","this","element","accept","multiple","maxSize","onDrop","onError","hoverClass","document","querySelector","fileInput","createElement","type","style","display","appendChild","init","console","error","addEventListener","e","target","click","handleFiles","files","preventDefault","stopPropagation","classList","add","remove","dataTransfer","length","validFiles","Array","from","filter","file","size","triggerError","name","acceptTypes","split","map","trim","fileType","fileExtension","pop","some","startsWith","toLowerCase","endsWith","typeGroup","value","message","initDashboardQuiz","async","fetchQuizzes","response","fetch","method","headers","result","json","success","Error","quizzes","quizItemTemplate","getElementById","quizList","innerHTML","forEach","quiz","quizItemElement","content","cloneNode","row","textContent","title","confirm","quizId","alert","deleteQuiz","_id","cursor","gotoQuizEdit","errorIndicator","validation","createQuizList","data","window","location","href","description","rounds","text","quizData","JSON","parse","body","stringify","importQuizFromFile"],"mappings":"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"}