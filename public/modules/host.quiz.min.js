var Quiz=function(){"use strict";class e extends Phaser.Scene{constructor(){super(...arguments),Object.defineProperty(this,"resizeHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shutdownHandler",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"socket",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}init(){console.log(`${this.scene.key}:: BaseScene.init: hello`),this.resizeHandler=e=>{this.handleResize(e)},this.shutdownHandler=()=>{this.shutdown()},this.scale.on("resize",this.resizeHandler),this.events.on("shutdown",this.shutdownHandler),this.handleResize(this.scale.gameSize);const e=this.plugins.get("SocketManagerPlugin");if(!e)throw new Error("SocketManagerPlugin not found");const t=e.getSocket();if(!t)throw new Error("Socket not initialized");this.socket=t,this.socket.onAny(((e,...t)=>{console.log("BaseScene:: Socket event:",e,t)}))}handleResize(e){console.log(`${this.scene.key}:: BaseScene.handleResize:`,e.width,e.height);const t=e.width/1920,i=e.height/t,r=this.cameras.main;r.setOrigin(0,0),r.setZoom(t),this.updateHeight(i)}updateHeight(t){console.log("BaseScene:: updateHeight:",t),e.currentHeight=t}getY(e){return e*this.getScaleFactor()}getScaleFactor(){return e.currentHeight/1080}shutdown(){console.log("BaseScene:: shutdown"),this.scale.off("resize",this.resizeHandler),this.events.off("shutdown",this.shutdownHandler),this.socket.removeAllListeners(),this.sceneShutdown()}}Object.defineProperty(e,"currentHeight",{enumerable:!0,configurable:!0,writable:!0,value:1080});class t{constructor(e){Object.defineProperty(this,"scene",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"registry",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),this.scene=e}register(e,t){this.registry.set(e,t)}create(e,t){const i=this.registry.get(e);if(!i)return console.error(`Question type not registered: ${e}`),null;try{switch(e){case"multiple-choice":return new(0,require(i).default)(this.scene,t);case"true-false":return new(0,require(i).default)(this.scene,t);case"hotspot":return new(0,require(i).default)(this.scene,t);case"point-it-out":return new(0,require(i).default)(this.scene,t);case"ordering":return new(0,require(i).default)(this.scene,t);case"matching":return new(0,require(i).default)(this.scene,t);case"text":return new(0,require(i).default)(this.scene,t);case"draw":return new(0,require(i).default)(this.scene,t);default:return console.error(`Unknown question type: ${e}`),null}}catch(t){return console.error(`Error creating question type ${e}:`,t),null}}}class i extends e{constructor(){super(i.KEY),Object.defineProperty(this,"questions",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"currentQuestion",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"currentRound",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"currentQuestionIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"currentRoundIndex",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"playerScores",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"playerAnswers",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"questionFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"roundDisplay",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timerBar",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timerText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"scoreBoard",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}init(){super.init(),this.playerScores=new Map,this.playerAnswers=new Map,this.questionFactory=new t(this),this.setupSocketListeners()}preload(){this.load.image("quiz-background","assets/quiz-bg.png"),this.load.image("answer-button","assets/quiz-button.png"),this.load.image("player-marker","assets/player-marker.png"),this.load.rexWebFont({google:{families:["Titan One"]}}),this.load.audio("countdown","assets/sounds/countdown.mp3"),this.load.audio("correct","assets/sounds/correct.mp3"),this.load.audio("incorrect","assets/sounds/incorrect.mp3"),this.registerQuestionRenderers()}create(){this.add.image(0,0,"quiz-background").setOrigin(0,0),this.createUI(),this.socket.emit("host:quiz-ready")}setupSocketListeners(){this.socket.on("server:introquiz",(e=>{this.showQuizIntro(e.title,e.description)})),this.socket.on("server:introround",(e=>{this.showRoundIntro(e.roundnumber,e.title,e.description)})),this.socket.on("server:question",(e=>{this.displayQuestion(e)})),this.socket.on("server:questionanswered",(e=>{this.playerAnswers.set(e.sessionID,e.response),this.updatePlayerAnswer(e.sessionID,e.response)})),this.socket.on("server:showanswer",(e=>{this.showAnswer(e)})),this.socket.on("server:updatescores",(e=>{this.updateScores(e.scores)})),this.socket.on("server:endround",(e=>{this.endRound(e)})),this.socket.on("server:endquiz",(e=>{this.showFinalScores()})),this.socket.on("server:starttimer",(e=>{this.startTimer(e.duration)}))}createUI(){this.roundDisplay=this.add.text(this.cameras.main.width/2,50,"",{fontSize:"32px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:4}).setOrigin(.5),this.timerBar=this.add.graphics(),this.timerText=this.add.text(this.cameras.main.width/2,600,"",{fontSize:"28px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:3}).setOrigin(.5),this.scoreBoard=this.add.container(50,650)}registerQuestionRenderers(){this.questionFactory.register("multiple-choice","./quiz/MultipleChoiceQuestion"),this.questionFactory.register("true-false","./quiz/TrueFalseQuestion"),this.questionFactory.register("hotspot","./quiz/HotspotQuestion"),this.questionFactory.register("point-it-out","./quiz/PointItOutQuestion"),this.questionFactory.register("ordering","./quiz/OrderingQuestion"),this.questionFactory.register("matching","./quiz/MatchingQuestion"),this.questionFactory.register("text","./quiz/TextQuestion"),this.questionFactory.register("draw","./quiz/DrawQuestion")}showQuizIntro(e,t){this.clearQuestion();const i=this.add.text(this.cameras.main.width/2,200,e,{fontSize:"64px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),r=t.replace(/<\/?[^>]+(>|$)/g,""),s=this.add.text(this.cameras.main.width/2,350,r,{fontSize:"32px",fontFamily:"Arial",color:"#ffffff",align:"center",wordWrap:{width:this.cameras.main.width-200}}).setOrigin(.5),n=this.add.text(this.cameras.main.width/2,550,"START QUIZ",{fontSize:"36px",fontFamily:'"Titan One", Arial',color:"#ffffff",backgroundColor:"#0066cc",padding:{x:30,y:15}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.socket.emit("host:next")}));this.tweens.add({targets:[i,s,n],alpha:{from:0,to:1},y:"-=30",duration:800,ease:"Power2",stagger:200})}showRoundIntro(e,t,i){this.clearQuestion(),this.roundDisplay.setText(`Round ${e}: ${t}`);const r=this.add.text(this.cameras.main.width/2,250,`Round ${e}`,{fontSize:"48px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:5}).setOrigin(.5),s=this.add.text(this.cameras.main.width/2,320,t,{fontSize:"64px",fontFamily:'"Titan One", Arial',color:"#ffff00",stroke:"#000000",strokeThickness:6,align:"center"}).setOrigin(.5),n=i.replace(/<\/?[^>]+(>|$)/g,""),o=this.add.text(this.cameras.main.width/2,420,n,{fontSize:"32px",fontFamily:"Arial",color:"#ffffff",align:"center",wordWrap:{width:this.cameras.main.width-200}}).setOrigin(.5),a=this.add.text(this.cameras.main.width/2,550,"START ROUND",{fontSize:"36px",fontFamily:'"Titan One", Arial',color:"#ffffff",backgroundColor:"#0066cc",padding:{x:30,y:15}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.socket.emit("host:next")}));this.tweens.add({targets:[r,s,o,a],alpha:{from:0,to:1},y:"-=30",duration:800,ease:"Power2",stagger:200})}displayQuestion(e){this.currentQuestionIndex=e.questionNumber,this.clearQuestion(),this.currentQuestion=this.questionFactory.create(e.type,e),this.currentQuestion&&this.currentQuestion.display(),this.playerAnswers.clear()}showAnswer(e){this.currentQuestion&&this.currentQuestion.showAnswer(e)}startTimer(e){this.timerBar.clear(),this.timerBar.fillStyle(65280,1),this.timerBar.fillRect(this.cameras.main.width/2-300,600,600,30),this.timerText.setText(`${e}`),this.tweens.add({targets:{width:600},width:0,duration:1e3*e,onUpdate:t=>{const i=t.getValue(),r=Math.max(0,i);let s;const n=r/600;s=n>.7?65280:n>.3?16776960:16711680,this.timerBar.clear(),this.timerBar.fillStyle(s,1),this.timerBar.fillRect(this.cameras.main.width/2-300,600,r,30);const o=Math.ceil(n*e);this.timerText.setText(`${o}`)}})}updateTimer(e){}updatePlayerAnswer(e,t){this.currentQuestion&&this.currentQuestion.updatePlayerAnswer(e,t)}updateScores(e){Object.entries(e).forEach((([e,t])=>{this.playerScores.set(e,t)})),this.scoreBoard.removeAll(!0);Array.from(this.playerScores.entries()).sort(((e,t)=>t[1]-e[1])).forEach((([e,t],i)=>{const r=this.getPlayerName(e),s=this.add.text(0,40*i,`${r}: ${t}`,{fontSize:"24px",fontFamily:"Arial",color:"#ffffff"});this.scoreBoard.add(s)})),this.tweens.add({targets:this.scoreBoard.getAll(),scale:{from:1.2,to:1},duration:300,ease:"Back.easeOut"})}getPlayerName(e){return`Player ${e.substring(0,4)}`}endRound(e){this.clearQuestion();const t=this.add.text(this.cameras.main.width/2,250,e.title,{fontSize:"64px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:6}).setOrigin(.5),i=this.add.text(this.cameras.main.width/2,350,e.description,{fontSize:"32px",fontFamily:"Arial",color:"#ffffff",align:"center",wordWrap:{width:this.cameras.main.width-200}}).setOrigin(.5),r=this.add.text(this.cameras.main.width/2,500,"CONTINUE",{fontSize:"36px",fontFamily:'"Titan One", Arial',color:"#ffffff",backgroundColor:"#0066cc",padding:{x:30,y:15}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.socket.emit("host:next")}));this.tweens.add({targets:[t,i,r],alpha:{from:0,to:1},y:"-=30",duration:800,ease:"Power2",stagger:200})}showFinalScores(){this.clearQuestion(),this.add.text(this.cameras.main.width/2,200,"QUIZ COMPLETE!",{fontSize:"72px",fontFamily:'"Titan One", Arial',color:"#ffff00",stroke:"#000000",strokeThickness:8}).setOrigin(.5);let e="",t=0;this.playerScores.forEach(((i,r)=>{i>t&&(t=i,e=this.getPlayerName(r))})),this.add.text(this.cameras.main.width/2,300,`Winner: ${e} with ${t} points!`,{fontSize:"48px",fontFamily:'"Titan One", Arial',color:"#ffffff",stroke:"#000000",strokeThickness:6}).setOrigin(.5);const i=Array.from(this.playerScores.entries()).sort(((e,t)=>t[1]-e[1]));i.forEach((([e,t],i)=>{const r=this.getPlayerName(e);this.add.text(this.cameras.main.width/2,400+40*i,`${i+1}. ${r}: ${t}`,{fontSize:"32px",fontFamily:"Arial",color:"#ffffff"}).setOrigin(.5)})),this.add.text(this.cameras.main.width/2,400+40*i.length+60,"RETURN TO LOBBY",{fontSize:"36px",fontFamily:'"Titan One", Arial',color:"#ffffff",backgroundColor:"#0066cc",padding:{x:30,y:15}}).setOrigin(.5).setInteractive({useHandCursor:!0}).on("pointerdown",(()=>{this.scene.start("Lobby")}))}clearQuestion(){this.currentQuestion&&(this.currentQuestion.destroy(),this.currentQuestion=null)}sceneShutdown(){console.log("Quiz:: sceneShutdown...")}}return Object.defineProperty(i,"KEY",{enumerable:!0,configurable:!0,writable:!0,value:"QuizHostScene"}),Phaser.AUTO,Phaser.Scale.RESIZE,i}();
//# sourceMappingURL=host.quiz.min.js.map
