let e=!1,t=!1;const o=e=>({success:e.ok,status:e.status}),n=(e,t=!1)=>{const o=document.getElementById("message");o?(o.innerHTML=e,o.className=t?"error":"success",o.style.display="block"):alert(e)},r=()=>{t?(t=!t,e=!1):e=!e,s()},a=()=>{t=!0,s()},s=()=>{const o=document.getElementById("formTitle"),n=document.getElementById("submitButton"),r=document.getElementById("switchMessage"),a=document.getElementById("switchButton")||document.getElementById("switchLink"),s=document.getElementById("socialButtons"),i=document.getElementById("password"),c=document.getElementById("forgotPassword");t?(o&&(o.textContent="Forgotten password?"),n&&(n.textContent="Send reset email"),a&&(a.textContent="Back to Sign In"),r&&(r.textContent=""),s&&(s.style.display="none"),i&&(i.style.display="none",i.required=!1),c&&(c.style.display="none")):e?(o&&(o.textContent="Create an account"),n&&(n.textContent="Sign Up"),a&&(a.textContent="Sign In"),r&&(r.textContent="Already have an account?"),s&&(s.style.display="none"),i&&(i.style.display="block",i.required=!0),c&&(c.style.display="none")):(o&&(o.textContent="Sign in to your account"),n&&(n.textContent="Sign In"),a&&(a.textContent="Sign Up"),r&&(r.textContent="Don't have an account?"),s&&(s.style.display="block"),i&&(i.style.display="block",i.required=!0),c&&(c.style.display="block"));const d=document.getElementById("message");d&&(d.textContent="",d.style.display="none")},i=async r=>{r.preventDefault();const a=r.target,s=new FormData(a),i=s.get("email"),c=s.get("password");if(!i)return void n("Please enter your email",!0);if(!t&&!c)return void n("Please enter your password",!0);const l=t?"/auth/forgot-password":e?"/auth/signup":"/auth/login";console.log("Submitting to:",l,i,c);try{const e=await fetch(l,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:i,password:c})}),{success:r,status:a}=o(e);if(console.log("handleSubmit response:",r,a,e),r)if(t)d();else{const e=new URLSearchParams(window.location.search).get("redirect");window.location.href=e?decodeURIComponent(e):"/host/dashboard",console.log("Redirecting after login/signup")}else switch(a){case 401:n("Unknown email/password combination",!0);break;case 409:n("Email already in our system :(<br>Have you forgotten your password? Try the link below...",!0);break;case 422:n("Invalid input. Please check your email and password.",!0);break;default:n(data.message||"An error occurred. Please try again.",!0)}}catch(e){n("A network error occurred. Please check your connection and try again.",!0),console.error("Network Error:",e)}},c=async e=>{e.preventDefault();const t=e.target,r=new FormData(t),a=r.get("password"),s=r.get("password-confirm");if(!a-confirm||!a)return void n("Please enter both password and confirm password",!0);if(a!==s)return void n("Passwords do not match",!0);const i=new URLSearchParams(window.location.search).get("token");if(!i)return void n("Error - please click the link in the set password email",!0);const c="/auth/reset-password";console.log("Submitting to:",c,i,a);try{const e=await fetch(c,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:i,password:a})}),{success:t,status:r}=o(e);if(console.log("handleSubmit response:",t,r,e),t)n("Password reset successfully. Redirecting to login...",!0);else switch(r){case 400:n("Hmmm... seems the email link has expired. Hang on, we'll redirect you",!0);break;case 401:n("Hmmm... that didn't work :(",!0);break;case 409:n("Email already in our system :(<br>Have you forgotten your password? Try the link below...",!0);break;case 422:n("Invalid input. Please check your email and password.",!0);break;default:n("An error occurred. Please try again.",!0)}setTimeout((()=>{window.location.href="/login"}),6e3)}catch(e){n("A network error occurred. Please check your connection and try again.",!0),console.error("Network Error:",e)}},d=()=>{console.log("terminateForgotPasswordFlow"),n("Password reset initiated. Check your email for further instructions.",!0),setTimeout((()=>{window.location.href="/login"}),6e3)},l=e=>{const t=new URLSearchParams(window.location.search).get("redirect");let o=`/auth/${e}`;t&&(o+=`?redirect=${encodeURIComponent(t)}`),window.location.href=o};document.addEventListener("DOMContentLoaded",(()=>{const t=document.getElementById("auth-form")||document.getElementById("authForm"),o=document.getElementById("switchButton")||document.getElementById("switchLink"),d=document.getElementById("forgotPassword"),u=document.getElementById("googleLogin"),m=document.getElementById("facebookLogin"),g=new URLSearchParams(window.location.search);"signup"===g.get("mode")&&(e=!0,s()),t&&t.addEventListener("submit",i),o&&o.addEventListener("click",r),d&&d.addEventListener("click",a),u&&u.addEventListener("click",(()=>l("google"))),m&&m.addEventListener("click",(()=>l("facebook")));const y=document.getElementById("resetPasswordForm");y&&y.addEventListener("submit",c),document.getElementById("message");const w=g.get("error");if(w)switch(w){case"auth_error":n("An error occurred during authentication. Please try again.",!0);break;case"auth_failed":n("Authentication failed. Please try again.",!0);break;case"login_error":n("An error occurred during login. Please try again.",!0);break;case"profile_error":n("An error occurred processing your profile. Please try again.",!0);break;case"verification_failed":n("Verification failed - we suggest you follow the 'Forgot Password' link below",!0);break;default:n("An error occurred. Please try again.",!0)}}));
//# sourceMappingURL=login.min.js.map
