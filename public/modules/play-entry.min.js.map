{"version":3,"file":"play-entry.min.js","sources":["../../src/utils/auth.js","../../src/scripts/play-entry.js"],"sourcesContent":["/**\r\n * Auth utility for managing user roles and session state in the frontend.\r\n */\r\n\r\nexport class Auth {\r\n    static async getUser() {\r\n        try {\r\n            const response = await fetch('/auth/me');\r\n            if (!response.ok) return null;\r\n            const data = await response.json();\r\n            console.log('Auth.getUser response:', data);\r\n            return (data.success && data.data) ? data.data.user : null;\r\n        } catch (error) {\r\n            console.error('Auth.getUser error:', error);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    static async checkRole(requiredRole) {\r\n        const user = await this.getUser();\r\n        if (!user) return false;\r\n        \r\n        const roles = ['new', 'host', 'admin'];\r\n        const userRoleIndex = roles.indexOf(user.role);\r\n        const requiredRoleIndex = roles.indexOf(requiredRole);\r\n        \r\n        return userRoleIndex >= requiredRoleIndex;\r\n    }\r\n\r\n    /**\r\n     * Dynamically shows/hides elements based on user role.\r\n     * Elements should have a data-role attribute.\r\n     */\r\n    static async syncUI() {\r\n        const user = await this.getUser();\r\n        const role = user ? user.role : 'guest';\r\n        const roleLevel = this.getRoleLevel(role);\r\n        \r\n        document.querySelectorAll('[data-role], [data-role-max]').forEach(el => {\r\n            const minRole = el.getAttribute('data-role');\r\n            const maxRole = el.getAttribute('data-role-max');\r\n            \r\n            const minLevel = minRole ? this.getRoleLevel(minRole) : 0;\r\n            const maxLevel = maxRole ? this.getRoleLevel(maxRole) : 99;\r\n            \r\n            // Show if: UserLevel >= MinLevel AND UserLevel <= MaxLevel\r\n            if (roleLevel >= minLevel && roleLevel <= maxLevel) {\r\n                el.style.display = '';\r\n            } else {\r\n                el.style.display = 'none';\r\n            }\r\n        });\r\n    }\r\n\r\n    static getRoleLevel(roleName) {\r\n        const roles = { 'guest': 0, 'new': 1, 'host': 2, 'admin': 3 };\r\n        return roles[roleName] || 0;\r\n    }\r\n\r\n}\r\n","import { Auth } from '../utils/auth.js';\r\n\r\n// State\r\nconst avatarlist = [\r\n    12138118, 12138231, 12138743, 12138846, 12139963, 12140600, 12143538, 12189343,\r\n    12214366, 12215207, 12232806, 12348050, 12358126, 12358607, 12359578, 12360465,\r\n    12370419, 12370830, 12391847, 12436639, 12454847, 12474909, 12502935, 12660677,\r\n    12789062, 12791500, 13003915, 13100182,\r\n];\r\n\r\n// Functions\r\nfunction toggleFullScreen() {\r\n    const docElm = document.documentElement;\r\n    if (!document.fullscreenElement &&\r\n        !document.mozFullScreenElement &&\r\n        !document.webkitFullscreenElement &&\r\n        !document.msFullscreenElement) {\r\n\r\n        if (docElm.requestFullscreen) {\r\n            docElm.requestFullscreen();\r\n        } else if (docElm.webkitRequestFullscreen) {\r\n            docElm.webkitRequestFullscreen();\r\n        } else if (docElm.mozRequestFullScreen) {\r\n            docElm.mozRequestFullScreen();\r\n        } else if (docElm.msRequestFullscreen) {\r\n            docElm.msRequestFullscreen();\r\n        }\r\n    }\r\n}\r\n\r\nfunction selectAvatar(e) {\r\n    const avatarId = e.target.id;\r\n    document.getElementById('avatar').value = avatarId;\r\n    \r\n    // Reset all borders and classes\r\n    document.querySelectorAll('#gallerycontainer .gallery').forEach(el => {\r\n        el.classList.remove('selected');\r\n    });\r\n    // Highlight selected\r\n    const galleryItem = e.target.closest('.gallery');\r\n    if (galleryItem) {\r\n        galleryItem.classList.add('selected');\r\n    }\r\n    updateButtonState();\r\n}\r\n\r\nfunction updateButtonState() {\r\n    const form = document.getElementById('gameform');\r\n    const submitBtn = document.getElementById('submit');\r\n    if (!form || !submitBtn) return;\r\n\r\n    const name = form.name.value.trim();\r\n    const room = form.room.value.trim();\r\n    const avatar = form.avatar.value;\r\n\r\n    const isValid = name !== \"\" && room !== \"\" && avatar !== \"\";\r\n    submitBtn.style.opacity = isValid ? \"1\" : \"0.5\";\r\n}\r\n\r\nfunction addAvatar(element) {\r\n    const gallery = document.getElementById(\"gallerycontainer\");\r\n    if (!gallery) return;\r\n\r\n    const newAvatar = document.createElement('div');\r\n    newAvatar.setAttribute('class', 'gallery');\r\n    newAvatar.innerHTML = `\r\n        <img id='${element}' src=\"/img/avatar-100/image-from-rawpixel-id-${element}-original.png\">\r\n    `;\r\n    newAvatar.addEventListener(\"click\", selectAvatar);\r\n    gallery.appendChild(newAvatar);\r\n}\r\n\r\nasync function checkForm(event) {\r\n    const form = document.getElementById('gameform');\r\n    const name = form.name.value.trim();\r\n    const room = form.room.value.trim();\r\n    const avatar = form.avatar.value;\r\n    const errorEl = document.getElementById('form-error');\r\n\r\n    if (errorEl) {\r\n        errorEl.style.display = 'none';\r\n        errorEl.textContent = '';\r\n    }\r\n\r\n    if (name === \"\" || room === \"\" || avatar === \"\") {\r\n        event.preventDefault();\r\n        if (errorEl) {\r\n            errorEl.style.display = 'block';\r\n            if (room === \"\") errorEl.textContent = \"Please enter a room code\";\r\n            else if (name === \"\") errorEl.textContent = \"Please enter your team name\";\r\n            else if (avatar === \"\") errorEl.textContent = \"Please choose an avatar\";\r\n        }\r\n        return false;\r\n    }\r\n\r\n    try {\r\n        toggleFullScreen();\r\n        // We don't need the timeout here if we're using addEventListener\r\n    } catch (err) {\r\n        console.log('Fullscreen error:', err);\r\n    }\r\n    return true;\r\n}\r\n\r\n// Initialization\r\ndocument.addEventListener('DOMContentLoaded', async () => {\r\n    const form = document.getElementById('gameform');\r\n    if (form) {\r\n        form.addEventListener('submit', checkForm);\r\n        form.name.addEventListener('input', updateButtonState);\r\n        form.room.addEventListener('input', updateButtonState);\r\n    }\r\n\r\n    // Check if ROOMID is set in URL\r\n    const urlParams = new URLSearchParams(window.location.search);\r\n    const roomID = urlParams.get('room');\r\n    if (roomID && document.getElementById('room')) {\r\n        document.getElementById('room').value = roomID;\r\n    }\r\n\r\n    // Populate avatars\r\n    avatarlist.forEach(element => {\r\n        addAvatar(element);\r\n    });\r\n\r\n    // Auth Integration\r\n    const user = await Auth.getUser();\r\n    const authStatus = document.getElementById('auth-status');\r\n    \r\n    if (authStatus) {\r\n        if (user) {\r\n            authStatus.innerHTML = `\r\n                <div style=\"background: rgba(16, 185, 129, 0.15); padding: 12px 20px; border-radius: 16px; display: inline-flex; align-items: center; gap: 10px; border: 1px solid rgba(16, 185, 129, 0.2);\">\r\n                    <div style=\"width: 8px; height: 8px; background: #10b981; border-radius: 50%; box-shadow: 0 0 10px #10b981;\"></div>\r\n                    <span style=\"color: #fff; font-size: 0.9rem;\">Playing as <strong>${user.displayname || user.email}</strong></span>\r\n                </div>\r\n            `;\r\n            \r\n            if (user.displayname && document.getElementById('name')) {\r\n                document.getElementById('name').value = user.displayname;\r\n            }\r\n\r\n            if (user.avatar) {\r\n                const avatarImg = document.getElementById(user.avatar);\r\n                if (avatarImg) {\r\n                    avatarImg.click();\r\n                }\r\n            }\r\n            updateButtonState();\r\n        } else {\r\n            const currentPath = window.location.pathname + window.location.search;\r\n            authStatus.innerHTML = `\r\n                <div style=\"background: rgba(255, 255, 255, 0.05); padding: 10px 15px; border-radius: 16px; display: inline-block; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); white-space: nowrap;\">\r\n                    <span style=\"color: var(--clr-text-muted); font-size: 0.85rem;\">Save your scores?</span>\r\n                    <a href=\"/login?redirect=${encodeURIComponent(currentPath)}\" style=\"color: var(--clr-accent); text-decoration: none; font-weight: 700; margin-left: 6px; font-size: 0.85rem;\">Login</a>\r\n                    <span style=\"margin: 0 6px; color: rgba(255,255,255,0.2);\">|</span>\r\n                    <a href=\"/login?mode=signup&redirect=${encodeURIComponent(currentPath)}\" style=\"color: var(--clr-accent); text-decoration: none; font-weight: 700; font-size: 0.85rem;\">Sign Up</a>\r\n                </div>\r\n            `;\r\n        }\r\n    }\r\n    updateButtonState();\r\n});\r\n"],"names":["Auth","getUser","response","fetch","ok","data","json","console","log","success","user","error","checkRole","requiredRole","this","roles","indexOf","role","syncUI","roleLevel","getRoleLevel","document","querySelectorAll","forEach","el","minRole","getAttribute","maxRole","minLevel","maxLevel","style","display","roleName","guest","new","host","admin","avatarlist","selectAvatar","e","avatarId","target","id","getElementById","value","classList","remove","galleryItem","closest","add","updateButtonState","form","submitBtn","name","trim","room","avatar","isValid","opacity","async","checkForm","event","errorEl","textContent","preventDefault","docElm","documentElement","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen","toggleFullScreen","err","addEventListener","roomID","URLSearchParams","window","location","search","get","element","gallery","newAvatar","createElement","setAttribute","innerHTML","appendChild","addAvatar","authStatus","displayname","email","avatarImg","click","currentPath","pathname","encodeURIComponent"],"mappings":"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"}