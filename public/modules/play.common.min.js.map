{"version":3,"file":"play.common.min.js","sources":["../../src/play.common.js"],"sourcesContent":["\r\nconst URL = 'http://localhost:3000';\r\n\r\n// Contact the socket.io socket server\r\n// clientOptions can be used to pass things like username/password - see docs\r\n// URL of undefined means io will connect to the window.location (suitable if hosting at same place as socket-server is running)\r\nclientOptions = {};\r\nconst socket = io();\r\n\r\n// console.log('play.common.js:: Hello:', URL, window.location, location.hash);\r\n\r\n\r\n// Functions to perform server actions - the only one we are interested in is server:loadgame\r\n// Everything else is handled by the relevant game module\r\nsocket.on('server:loadgame', (game) => {\r\n\t// console.log('Player:: server:loadgame:', game);\r\n\tloadGame(game);\r\n});\r\n\r\nasync function loadGame(game) {\r\n\r\n\ttry {\r\n\t\tconst module = await import(`./play.${game}.min.js`);\r\n\r\n\t\t// If import successful then we are good to go - check if there is a game already loaded\r\n\t\tif (window.currentGame) {\r\n\t\t\twindow.currentGame.end();\r\n\t\t\tdelete window.currentGame;\r\n\t\t\tunloadCSS();\r\n\t\t}\r\n\t\t// load CSS - fpr now we always load a CSS file and its always named the same as the game name\r\n\t\tloadCSS(game);\r\n\t\tconst newGame = new module.Game(socket);\r\n\r\n\t\t// Store the game instance for later use\r\n\t\twindow.currentGame = newGame;\r\n\r\n\t} catch (error) {\r\n\t\tconsole.error('Error loading the game module:', error);\r\n\t\t// TODO: Display status to the user...\r\n\t}\r\n}\r\n\r\nfunction unloadGame() {\r\n\tif (window.currentGame) {\r\n\t\twindow.currentGame.end();\r\n\t\tdelete window.currentGame;\r\n\t\tunloadCSS();\r\n\t}\r\n}\r\n\r\nfunction loadCSS(href) {\r\n\tconst link = document.createElement('link');\r\n\tlink.rel = 'stylesheet';\r\n\tlink.href = `/css/${href}.css`;\r\n\tlink.id = 'dynamic-css'; // Give an ID to easily find and remove it later\r\n\tdocument.head.appendChild(link);\r\n}\r\n\r\nfunction unloadCSS() {\r\n\tconst link = document.getElementById('dynamic-css');\r\n\tif (link) {\r\n\t\tdocument.head.removeChild(link);\r\n\t}\r\n}\r\n\r\nasync function stayAwake() {\r\n\t// console.log('stayAwake:', document.visibilityState);\r\n\tif (document.visibilityState === 'visible') {\r\n\t\tif (lock === null) {\r\n\t\t\tif ('wakeLock' in navigator) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlock = await navigator.wakeLock.request('screen');\r\n\t\t\t\t\t// console.log('Screen Wake Lock is active:', lock);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\tconsole.error(`${err.name}, ${err.message}`);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tconsole.error('Wake Lock API not supported.');\r\n\t\t\t\tsocket.emit('consolelog', 'Wake Lock API not supported.');\r\n\t\t\t\tsocket.emit('consolelog', navigator);\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tif (lock !== null) {\r\n\t\t\tawait lock.release();\r\n\t\t\tlock = null;\r\n\t\t\tconsole.log('Screen Wake Lock released:', lock);\r\n\t\t\tsocket.emit('consolelog', 'Screen Wake Lock released:' + lock);\r\n\t\t}\r\n\t}\r\n}\r\nlet lock = null;\r\ndocument.addEventListener('visibilitychange', stayAwake);\r\nstayAwake();\r\n\r\n\r\n"],"names":["clientOptions","socket","io","async","stayAwake","document","visibilityState","lock","navigator","wakeLock","request","err","console","error","name","message","emit","release","log","on","game","module","import","window","currentGame","end","link","getElementById","head","removeChild","unloadCSS","href","createElement","rel","id","appendChild","loadCSS","newGame","Game","loadGame","addEventListener"],"mappings":"AAMAA,cAAgB,GAChB,MAAMC,EAASC,KA2DfC,eAAeC,IAEd,GAAiC,YAA7BC,SAASC,iBACZ,GAAa,OAATC,EACH,GAAI,aAAcC,UACjB,IACCD,QAAaC,UAAUC,SAASC,QAAQ,SAExC,CAAC,MAAOC,GACRC,QAAQC,MAAM,GAAGF,EAAIG,SAASH,EAAII,UAClC,MAEDH,QAAQC,MAAM,gCACdZ,EAAOe,KAAK,aAAc,gCAC1Bf,EAAOe,KAAK,aAAcR,gBAIf,OAATD,UACGA,EAAKU,UACXV,EAAO,KACPK,QAAQM,IAAI,6BAA8BX,GAC1CN,EAAOe,KAAK,aAAc,6BAA+BT,GAG5D,CA7EAN,EAAOkB,GAAG,mBAAoBC,KAK9BjB,eAAwBiB,GAEvB,IACC,MAAMC,QAAeC,OAAO,UAAUF,YAGlCG,OAAOC,cACVD,OAAOC,YAAYC,aACZF,OAAOC,YAgCjB,WACC,MAAME,EAAOrB,SAASsB,eAAe,eACjCD,GACHrB,SAASuB,KAAKC,YAAYH,EAE5B,CApCGI,IAuBH,SAAiBC,GAChB,MAAML,EAAOrB,SAAS2B,cAAc,QACpCN,EAAKO,IAAM,aACXP,EAAKK,KAAO,QAAQA,QACpBL,EAAKQ,GAAK,cACV7B,SAASuB,KAAKO,YAAYT,EAC3B,CA1BEU,CAAQhB,GACR,MAAMiB,EAAU,IAAIhB,EAAOiB,KAAKrC,GAGhCsB,OAAOC,YAAca,CAErB,CAAC,MAAOxB,GACRD,QAAQC,MAAM,iCAAkCA,EAEhD,CACF,CAzBC0B,CAASnB,EAAK,IA4Ef,IAAIb,EAAO,KACXF,SAASmC,iBAAiB,mBAAoBpC,GAC9CA"}