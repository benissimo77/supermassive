{"version":3,"file":"play.lobby.min.js","sources":["../../src/lobby/play.lobby.js"],"sourcesContent":["console.log('play.lobby.js:: hello');\r\n\r\n// This is a simple example of a game module\r\nexport class Game {\r\n\r\n    constructor(socket) {\r\n\r\n\t\t// Cache socket for later use (event handlers need socket)\r\n\t\tthis.socket = socket;\r\n\r\n\t\t// Just call start here - not sure if really need a constructor AND a start method\r\n\t\tthis.start();\r\n        console.log('Lobby initialized');\r\n    }\r\n  \r\n    start() {\r\n\t\tthis.loadFonts();\r\n\t\tthis.buildDOM();\r\n\t\tthis.attachSocketEvents(this.socket);\r\n\t\tthis.attachButtonEvents();\r\n\t\t\r\n\t\t// Show the first panel by default\r\n\t\tthis.showPanel('panel-start');\r\n\t}\r\n  \r\n    end() {\r\n      console.log('Ending the lobby...');\r\n\t  this.removeButtonEvents();\r\n\t  this.removeSocketEvents(this.socket);\r\n\t  this.unloadDOM();\r\n      this.unloadFonts();\r\n    }\r\n\r\n\t// Add all DOM elements relevant to the lobby\r\n\t// NOTE: everything is placed inside a wrapper div with id 'lobby' - then this entire div can be removed on cleanup\r\n\tbuildDOM() {\r\n\t\t// Create the DOM elements for the lobby\r\n\t\tconst lobby = document.createElement('div');\r\n\t\tlobby.id = 'lobby';\r\n\t\tdocument.body.appendChild(lobby);\r\n\t\tlobby.innerHTML = `\r\n\t\t\t<div class=\"panel\" id=\"panel-start\">\r\n\t\t\t\t<!-- For now put these here while testing -->\r\n\t\t\t\t<div class=\"panel-content\">\r\n\t\t\t\t\t<button id=\"connect\">Connect</button>\r\n\t\t\t\t\t<button id=\"disconnect\">Disconnect</button>\r\n\t\t\t\t\t<h1>Welcome!</h1>\r\n\t\t\t\t\t<p>Waiting to start...</p>        \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel\" id=\"panel-1\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-1\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel\" id=\"panel-2\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-2\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel\" id=\"panel-3\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-3\"></div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\t// Begin with the welcome panel - maybe do this via the buildDOM function above...\r\n\t\tthis.addButton('button-container-1', 'Final Button');\r\n\r\n\t\tthis.adjustFontSizeToFit('button-container-1');\r\n\t\t// this.adjustFontSizeToFit('button-container-2');\r\n\t\t// this.adjustFontSizeToFit('button-container-3');\r\n\t}\r\n\r\n\tunloadDOM() {\r\n\t\t// Remove all the DOM elements created by the lobby\r\n\t\tconst lobby = document.getElementById('lobby');\r\n\t\tlobby.remove();\r\n\t}\r\n\r\n\taddButton(panelId, buttonText) {\r\n\t\tconst buttonContainer = document.getElementById(panelId);\r\n\t\tconst button = document.createElement('button');\r\n\r\n\t\t// Adjust font size based on text length\r\n\t\tconst textLength = buttonText.length;\r\n\t\tif (textLength > 36) {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '16px');\r\n\t\t} else if (textLength > 16) {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '20px');\r\n\t\t} else {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '24px');\r\n\t\t}\r\n\t\t\r\n\t\tbutton.textContent = buttonText;\r\n\t\tbuttonContainer.appendChild(button);\r\n\t}\r\n\t\r\n\tadjustFontSizeToFit(containerId) {\r\n        const container = document.getElementById(containerId);\r\n        const buttons = container.querySelectorAll('button');\r\n        const availableHeight = window.innerHeight -  80;\t// we always want some padding top and bottom\r\n\r\n        // If many buttons then squash them together slightly more than if fewer buttons\r\n        if (buttons.length > 5) {\r\n            container.style.setProperty('gap', '4vh');\r\n        } else if (buttons.length > 4) {\r\n            container.style.setProperty('gap', '6vh');\r\n        } else {\r\n            container.style.setProperty('gap', '8vh');\r\n        }\r\n        \r\n\t\t// Belt and braces - prevent function from looping forever in the event of a bug\r\n\t\tlet loopCount = 30;\r\n\r\n\r\n\t\tconst adjustFontSize = () => {\r\n            let totalHeight = container.getBoundingClientRect().height;\r\n\t\t\tconsole.log('Adjusting font size:', totalHeight, availableHeight, loopCount);\r\n            if ( (totalHeight > availableHeight) && (loopCount > 0) ) {\r\n\t\t\t\tloopCount--;\r\n                buttons.forEach(button => {\r\n                    const currentFontSize = parseInt(window.getComputedStyle(button).fontSize);\r\n                    button.style.setProperty('--button-font-size', `${currentFontSize - 1}px`);\r\n                });\r\n\t\t\t\t// Another way to prevent any infinite loop - don't loop if fontsize is some minimum value\r\n\t\t\t\t// if (currentFontSize > 10) {\r\n\t\t\t\t// \trequestAnimationFrame(adjustFontSize); // Wait for the next animation frame before rechecking\r\n\t\t\t\t// }\r\n\t\t\t\trequestAnimationFrame(adjustFontSize); // Wait for the next animation frame before rechecking\r\n            }\r\n        };\r\n        requestAnimationFrame(adjustFontSize);\r\n    }\r\n\r\n\tshowPanel(panelId) {\r\n\t\tconst panels = document.querySelectorAll('.panel');\r\n\t\tpanels.forEach(panel => panel.classList.remove('active'));\r\n\t\tdocument.getElementById(panelId).classList.add('active');\r\n\t}\r\n\t\r\n\tsocketConnect(e) {\r\n\t\tthis.socket.connect();\r\n\t}\r\n\tsocketDisconnect() {\r\n\t\tthis.socket.disconnect();\r\n\t}\r\n\r\n    loadFonts() {\r\n        // const preconnect1 = document.createElement('link');\r\n        // preconnect1.rel = 'preconnect';\r\n        // preconnect1.href = 'https://fonts.googleapis.com';\r\n        // preconnect1.id = 'dynamic-font-preconnect-1';\r\n        // document.head.appendChild(preconnect1);\r\n    \r\n        const fontLink = document.createElement('link');\r\n        fontLink.rel = 'stylesheet';\r\n        fontLink.href = 'https://fonts.googleapis.com/css2?family=Lilita+One&display=swap';\r\n        fontLink.id = 'dynamic-font-link';\r\n        document.head.appendChild(fontLink);\r\n    }\r\n\r\n    unloadFonts() {\r\n        const fontLink = document.getElementById('dynamic-font-link');\r\n        if (fontLink) document.head.removeChild(fontLink);\r\n    }\r\n\r\n    attachSocketEvents(socket) {\r\n        console.log('Attaching socket events to lobby');\r\n        socket.on('connect', this.onConnect);\r\n        socket.on('disconnect', this.onDisconnect);\r\n        socket.on('player', this.onPlayer);\r\n    }\r\n\r\n    removeSocketEvents(socket) {\r\n        console.log('Removing socket events from lobby');\r\n        socket.off('connect', this.onConnect);\r\n        socket.off('disconnect', this.onDisconnect);\r\n        socket.off('player', this.onPlayer);\r\n\t}\r\n\r\n\tattachButtonEvents() {\r\n\t\t// Attach events to buttons defined in play.html that also rely on knowing socket\r\n\t\tdocument.getElementById('connect').addEventListener('click', this.socketConnect.bind(this) );\r\n\t\tdocument.getElementById('disconnect').addEventListener('click', this.socketDisconnect.bind(this) );\r\n\t}\r\n\tremoveButtonEvents() {\r\n\t\t// Remove event listeners added in the attach function above\r\n\t\tdocument.getElementById('connect').removeEventListener('click', this.socketConnect);\r\n\t\tdocument.getElementById('disconnect').removeEventListener('click', this.socketDisconnect);\r\n\t}\r\n\r\n\tonConnect() {\r\n\t\tconsole.log('Connected to server');\r\n\t}\r\n\tonDisconnect() {\r\n\t\tconsole.log('Disconnected from server');\r\n\t}\r\n\tonPlayer(player) {\r\n\t\tconsole.log('Player:', player);\r\n\t}\r\n  }"],"names":["console","log","Game","constructor","socket","this","start","loadFonts","buildDOM","attachSocketEvents","attachButtonEvents","showPanel","end","removeButtonEvents","removeSocketEvents","unloadDOM","unloadFonts","lobby","document","createElement","id","body","appendChild","innerHTML","addButton","adjustFontSizeToFit","getElementById","remove","panelId","buttonText","buttonContainer","button","textLength","length","style","setProperty","textContent","containerId","container","buttons","querySelectorAll","availableHeight","window","innerHeight","loopCount","adjustFontSize","totalHeight","getBoundingClientRect","height","forEach","currentFontSize","parseInt","getComputedStyle","fontSize","requestAnimationFrame","panel","classList","add","socketConnect","e","connect","socketDisconnect","disconnect","fontLink","rel","href","head","removeChild","on","onConnect","onDisconnect","onPlayer","off","addEventListener","bind","removeEventListener","player"],"mappings":"AAAAA,QAAQC,IAAI,yBAGL,MAAMC,EAET,WAAAC,CAAYC,GAGdC,KAAKD,OAASA,EAGdC,KAAKC,QACCN,QAAQC,IAAI,oBACf,CAED,KAAAK,GACFD,KAAKE,YACLF,KAAKG,WACLH,KAAKI,mBAAmBJ,KAAKD,QAC7BC,KAAKK,qBAGLL,KAAKM,UAAU,cACf,CAEE,GAAAC,GACEZ,QAAQC,IAAI,uBACfI,KAAKQ,qBACLR,KAAKS,mBAAmBT,KAAKD,QAC7BC,KAAKU,YACFV,KAAKW,aACN,CAIJ,QAAAR,GAEC,MAAMS,EAAQC,SAASC,cAAc,OACrCF,EAAMG,GAAK,QACXF,SAASG,KAAKC,YAAYL,GAC1BA,EAAMM,UAAY,4tBAsBlBlB,KAAKmB,UAAU,qBAAsB,gBAErCnB,KAAKoB,oBAAoB,qBAGzB,CAED,SAAAV,GAEeG,SAASQ,eAAe,SAChCC,QACN,CAED,SAAAH,CAAUI,EAASC,GAClB,MAAMC,EAAkBZ,SAASQ,eAAeE,GAC1CG,EAASb,SAASC,cAAc,UAGhCa,EAAaH,EAAWI,OAC1BD,EAAa,GAChBD,EAAOG,MAAMC,YAAY,qBAAsB,QACrCH,EAAa,GACvBD,EAAOG,MAAMC,YAAY,qBAAsB,QAE/CJ,EAAOG,MAAMC,YAAY,qBAAsB,QAGhDJ,EAAOK,YAAcP,EACrBC,EAAgBR,YAAYS,EAC5B,CAED,mBAAAN,CAAoBY,GACb,MAAMC,EAAYpB,SAASQ,eAAeW,GACpCE,EAAUD,EAAUE,iBAAiB,UACrCC,EAAkBC,OAAOC,YAAe,GAG1CJ,EAAQN,OAAS,EACjBK,EAAUJ,MAAMC,YAAY,MAAO,OAC5BI,EAAQN,OAAS,EACxBK,EAAUJ,MAAMC,YAAY,MAAO,OAEnCG,EAAUJ,MAAMC,YAAY,MAAO,OAI7C,IAAIS,EAAY,GAGhB,MAAMC,EAAiB,KACb,IAAIC,EAAcR,EAAUS,wBAAwBC,OAC7DhD,QAAQC,IAAI,uBAAwB6C,EAAaL,EAAiBG,GACnDE,EAAcL,GAAqBG,EAAY,IAC7DA,IACYL,EAAQU,SAAQlB,IACZ,MAAMmB,EAAkBC,SAAST,OAAOU,iBAAiBrB,GAAQsB,UACjEtB,EAAOG,MAAMC,YAAY,qBAAyBe,EAAkB,EAArB,KAA2B,IAM1FI,sBAAsBT,GACb,EAELS,sBAAsBT,EACzB,CAEJ,SAAAlC,CAAUiB,GACMV,SAASsB,iBAAiB,UAClCS,SAAQM,GAASA,EAAMC,UAAU7B,OAAO,YAC/CT,SAASQ,eAAeE,GAAS4B,UAAUC,IAAI,SAC/C,CAED,aAAAC,CAAcC,GACbtD,KAAKD,OAAOwD,SACZ,CACD,gBAAAC,GACCxD,KAAKD,OAAO0D,YACZ,CAEE,SAAAvD,GAOI,MAAMwD,EAAW7C,SAASC,cAAc,QACxC4C,EAASC,IAAM,aACfD,EAASE,KAAO,mEAChBF,EAAS3C,GAAK,oBACdF,SAASgD,KAAK5C,YAAYyC,EAC7B,CAED,WAAA/C,GACI,MAAM+C,EAAW7C,SAASQ,eAAe,qBACrCqC,GAAU7C,SAASgD,KAAKC,YAAYJ,EAC3C,CAED,kBAAAtD,CAAmBL,GACfJ,QAAQC,IAAI,oCACZG,EAAOgE,GAAG,UAAW/D,KAAKgE,WAC1BjE,EAAOgE,GAAG,aAAc/D,KAAKiE,cAC7BlE,EAAOgE,GAAG,SAAU/D,KAAKkE,SAC5B,CAED,kBAAAzD,CAAmBV,GACfJ,QAAQC,IAAI,qCACZG,EAAOoE,IAAI,UAAWnE,KAAKgE,WAC3BjE,EAAOoE,IAAI,aAAcnE,KAAKiE,cAC9BlE,EAAOoE,IAAI,SAAUnE,KAAKkE,SAChC,CAED,kBAAA7D,GAECQ,SAASQ,eAAe,WAAW+C,iBAAiB,QAASpE,KAAKqD,cAAcgB,KAAKrE,OACrFa,SAASQ,eAAe,cAAc+C,iBAAiB,QAASpE,KAAKwD,iBAAiBa,KAAKrE,MAC3F,CACD,kBAAAQ,GAECK,SAASQ,eAAe,WAAWiD,oBAAoB,QAAStE,KAAKqD,eACrExC,SAASQ,eAAe,cAAciD,oBAAoB,QAAStE,KAAKwD,iBACxE,CAED,SAAAQ,GACCrE,QAAQC,IAAI,sBACZ,CACD,YAAAqE,GACCtE,QAAQC,IAAI,2BACZ,CACD,QAAAsE,CAASK,GACR5E,QAAQC,IAAI,UAAW2E,EACvB"}