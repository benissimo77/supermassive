{"version":3,"file":"play.werewolves.min.js","sources":["../../src/werewolves/play.werewolves.js"],"sourcesContent":["console.log('play.werewolves.js is executing');\r\n\r\n// This is a simple example of a game module\r\nexport class Game {\r\n    constructor(socket) {\r\n\t\t// Cache socket for later use (event handlers need socket)\r\n\t\tthis.socket = socket;\r\n\r\n\t\t// Just call start here - not sure if really need a constructor AND a start method\r\n\t\tthis.start();\r\n        console.log('Werewolves game initialized');\r\n    }\r\n  \r\n    start() {\r\n      console.log('Starting the werewolves game...');\r\n      this.loadFonts();\r\n      this.buildDOM();\r\n      this.attachSocketEvents(this.socket);\r\n      this.attachButtonEvents();\r\n      \r\n      // Show the first panel by default\r\n      this.showPanel('panel-1');\r\n    }\r\n  \r\n    end() {\r\n        console.log('Ending the werewolves game...');\r\n        this.removeButtonEvents();\r\n        this.removeSocketEvents(this.socket);\r\n        this.unloadDOM();\r\n        this.unloadFonts();\r\n    }\r\n\r\n\t// Add all DOM elements relevant to the this game\r\n\t// NOTE: everything is placed inside a wrapper div - then this entire div can be removed on cleanup\r\n\tbuildDOM() {\r\n\t\t// Create the DOM elements for this game\r\n\t\tconst game = document.createElement('div');\r\n\t\tgame.id = 'game';\r\n\t\tdocument.body.appendChild(game);\r\n\t\tgame.innerHTML = `\r\n            <div id=\"rolecontainer\">\r\n                <button id=\"button-role\">ROLE</button>\r\n            </div>\r\n            <div class=\"panel\" id=\"panel-role\"></div>\r\n            \r\n\t\t\t<div class=\"panel\" id=\"panel-start\">\r\n\t\t\t\t<!-- For now put these here while testing -->\r\n\t\t\t\t<div class=\"panel-content\">\r\n\t\t\t\t\t<button id=\"connect\">Connect</button>\r\n\t\t\t\t\t<button id=\"disconnect\">Disconnect</button>\r\n\t\t\t\t\t<h1>Welcome!</h1>\r\n\t\t\t\t\t<p>Waiting to start...</p>        \r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n    \r\n\r\n\t\t\t<div class=\"panel\" id=\"panel-1\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-1\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel\" id=\"panel-2\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-2\"></div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"panel\" id=\"panel-3\">\r\n\t\t\t\t<div class=\"button-container\" id=\"button-container-3\"></div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\r\n\t\t// Begin with the welcome panel - maybe do this via the buildDOM function above...\r\n\t\t// this.addButton('button-container-1', 'QUIZ 1');\r\n\t\t// this.addButton('button-container-1', '5th button t...f.');\r\n\t\t// this.adjustFontSizeToFit('button-container-1');\t\t\r\n\r\n\t}\r\n\r\n    unloadDOM() {\r\n\t\t// Remove all the DOM elements created by this game\r\n\t\tconst game = document.getElementById('game');\r\n\t\tgame.remove();\r\n\t}\r\n\r\n\taddButton(panelId, buttonText) {\r\n\t\tconst buttonContainer = document.getElementById(panelId);\r\n\t\tconst button = document.createElement('button');\r\n\r\n\t\t// Adjust font size based on text length\r\n\t\tconst textLength = buttonText.length;\r\n\t\tif (textLength > 36) {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '16px');\r\n\t\t} else if (textLength > 16) {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '20px');\r\n\t\t} else {\r\n\t\t\tbutton.style.setProperty('--button-font-size', '24px');\r\n\t\t}\r\n\t\t\r\n\t\tbutton.textContent = buttonText;\r\n\t\tbuttonContainer.appendChild(button);\r\n\t}\r\n\t\r\n\tadjustFontSizeToFit(containerId) {\r\n        const container = document.getElementById(containerId);\r\n        const buttons = container.querySelectorAll('button');\r\n        const availableHeight = window.innerHeight -  80;\t// we always want some padding top and bottom\r\n\r\n        // If many buttons then squash them together slightly more than if fewer buttons\r\n        if (buttons.length > 5) {\r\n            container.style.setProperty('gap', '4vh');\r\n        } else if (buttons.length > 4) {\r\n            container.style.setProperty('gap', '6vh');\r\n        } else {\r\n            container.style.setProperty('gap', '8vh');\r\n        }\r\n        \r\n\t\t// Belt and braces - prevent function from looping forever in the event of a bug\r\n\t\tlet loopCount = 30;\r\n\r\n\r\n\t\tconst adjustFontSize = () => {\r\n            let totalHeight = container.getBoundingClientRect().height;\r\n\t\t\tconsole.log('Adjusting font size:', totalHeight, availableHeight, loopCount);\r\n            if ( (totalHeight > availableHeight) && (loopCount > 0) ) {\r\n\t\t\t\tloopCount--;\r\n                buttons.forEach(button => {\r\n                    const currentFontSize = parseInt(window.getComputedStyle(button).fontSize);\r\n                    button.style.setProperty('--button-font-size', `${currentFontSize - 1}px`);\r\n                });\r\n\t\t\t\trequestAnimationFrame(adjustFontSize); // Wait for the next animation frame before rechecking\r\n            }\r\n        };\r\n        requestAnimationFrame(adjustFontSize);\r\n    }\r\n\r\n\tshowPanel(panelId) {\r\n\t\tconst panels = document.querySelectorAll('.panel');\r\n\t\tpanels.forEach(panel => panel.classList.remove('active'));\r\n\t\tdocument.getElementById(panelId).classList.add('active');\r\n\t}\r\n\t\r\n\tsocketConnect(e) {\r\n\t\tthis.socket.connect();\r\n\t}\r\n\tsocketDisconnect() {\r\n\t\tthis.socket.disconnect();\r\n\t}\r\n  \r\n    loadFonts() {\r\n        // const preconnect1 = document.createElement('link');\r\n        // preconnect1.rel = 'preconnect';\r\n        // preconnect1.href = 'https://fonts.googleapis.com';\r\n        // preconnect1.id = 'dynamic-font-preconnect-1';\r\n        // document.head.appendChild(preconnect1);\r\n    \r\n        const fontLink = document.createElement('link');\r\n        fontLink.rel = 'stylesheet';\r\n        fontLink.href = 'https://fonts.googleapis.com/css2?family=Lilita+One&display=swap';\r\n        fontLink.id = 'dynamic-font-link';\r\n        document.head.appendChild(fontLink);\r\n    }\r\n\r\n    unloadFonts() {\r\n        const fontLink = document.getElementById('dynamic-font-link');\r\n        if (fontLink) document.head.removeChild(fontLink);\r\n    }\r\n\r\n    attachSocketEvents(socket) {\r\n        console.log('Attaching socket events to werewolves game');\r\n        // socket.on('server:request', this.onServerRequest);\r\n        // socket.on('playerrole', this.DOMplayerRole);\r\n        socket.on('connect', this.onConnect);\r\n        socket.on('disconnect', this.onDisconnect);\r\n        socket.on('player', this.onPlayer);\r\n        socket.on('playerrole', (role) => {\r\n            console.log('playerrole:', role);\r\n            this.DOMplayerRole(role);\r\n        })\r\n        \r\n    }\r\n\r\n    removeSocketEvents(socket) {\r\n        console.log('Removing socket events from werewolves game');\r\n        // socket.off('server:request', this.onServerRequest);\r\n        // socket.off('playerrole', this.DOMplayerRole);\r\n        socket.off('connect', this.onConnect);\r\n        socket.off('disconnect', this.onDisconnect);\r\n        socket.off('player', this.onPlayer);\r\n    }\r\n\r\n    attachButtonEvents() {\r\n        console.log('Attaching button events to werewolves game');\r\n\r\n        // ROLE button\r\n        const roleButton = document.getElementById('button-role');\r\n        roleButton.addEventListener('mousedown', this.buttonRolePress);\r\n        roleButton.addEventListener('mouseup', this.buttonRoleRelease);\r\n        roleButton.addEventListener('touchstart', this.buttonRolePress);\r\n        roleButton.addEventListener('touchend', this.buttonRoleRelease);\r\n        roleButton.addEventListener('selectstart', () => { return false });                \r\n    }\r\n\r\n    removeButtonEvents() {\r\n        console.log('Removing button events from werewolves game');\r\n        // document.getElementById('rolebutton').removeEventListener('mousedown', buttonRolePress);\r\n        // document.getElementById('rolebutton').removeEventListener('mouseup', buttonRoleRelease);\r\n    }\r\n    \r\n    buttonRolePress(e) {\r\n        console.log('buttonRolePress');\r\n        // In case there is already a visible panel we need to hide it - but store its ID so we can restore it afterwards\r\n        const panels = document.querySelectorAll('.panel .active');\r\n        console.log('panels:', panels);\r\n        let panelId = null;\r\n        if (panels.length > 0) {\r\n            panelId = panels[0].id;\r\n        }\r\n        document.getElementById(\"panel-role\").setAttribute(\"data-active\", panelId);    \r\n        this.showPanel('panel-role');\r\n    }\r\n    buttonRoleRelease() {\r\n        console.log('buttonRoleRelease');\r\n        const panelId = document.getElementById(\"panel-role\").getAttribute(\"data-active\");\r\n        this.showPanel(panelId);\r\n    }\r\n\r\n    DOMplayerRole(role) {\r\n\r\n        // fill out the role panel and make the role button visible so user can see their role\r\n        document.getElementById('panel-role').innerHTML = `\r\n            Your role:<br/><br/>${role}\r\n            `;\r\n        document.getElementById('rolecontainer').style.display = 'block';\r\n    }\r\n    \r\n\tonConnect() {\r\n\t\tconsole.log('Connected to server');\r\n\t}\r\n\tonDisconnect() {\r\n\t\tconsole.log('Disconnected from server');\r\n\t}\r\n\tonPlayer(player) {\r\n\t\tconsole.log('Player:', player);\r\n\t}\r\n\r\n  }"],"names":["console","log","Game","constructor","socket","this","start","loadFonts","buildDOM","attachSocketEvents","attachButtonEvents","showPanel","end","removeButtonEvents","removeSocketEvents","unloadDOM","unloadFonts","game","document","createElement","id","body","appendChild","innerHTML","getElementById","remove","addButton","panelId","buttonText","buttonContainer","button","textLength","length","style","setProperty","textContent","adjustFontSizeToFit","containerId","container","buttons","querySelectorAll","availableHeight","window","innerHeight","loopCount","adjustFontSize","totalHeight","getBoundingClientRect","height","forEach","currentFontSize","parseInt","getComputedStyle","fontSize","requestAnimationFrame","panel","classList","add","socketConnect","e","connect","socketDisconnect","disconnect","fontLink","rel","href","head","removeChild","on","onConnect","onDisconnect","onPlayer","role","DOMplayerRole","off","roleButton","addEventListener","buttonRolePress","buttonRoleRelease","panels","setAttribute","getAttribute","display","player"],"mappings":"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"}