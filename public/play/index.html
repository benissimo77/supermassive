<html lang="en">

<head>

    <meta charset="utf-8">

    <!-- âœ… Correct for fullscreen games -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
    
    <title>Videoswipe - Games</title>

    <!-- Add these meta tags for better iOS fullscreen support and PWA -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#051C55">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <!-- <link rel="apple-touch-icon" href="/img/app-icon.png"> -->
    <link rel="apple-touch-icon" href="/img/w3logo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Titan+One&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.4/gsap.min.js"></script>
    <link rel="stylesheet" href="/css/play.css">

    <style>
        #ios-prompt {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 12px;
            font-family: 'Poppins', sans-serif;
            text-align: center;
        }
    </style>

</head>

<body>
    <div align="center">
        <h1>Welcome</h1>
        <form method='post' id="gameform" name="gameform" onsubmit="return checkForm()">
            <label for="name" name="namelabel">Enter your name:</label><br>
            <input type="text" id="name" name="name" maxlength="15"><br>
            <label for="room" name="roomlabel">Enter room name:</label><br>
            <input type="text" id="room" name="room" maxlength="4">
            <br />
            <input type="hidden" id="avatar" name="avatar" value="">
            <label for="gallerycontainer" name="gallerylabel">Select your avatar:</label>
            <br><br>

            <div id="gallerycontainer" name="gallerycontainer"></div>

            <br style="clear:both" />
            <button type="submit" id='submit' value="Enter">ENTER</button>

        </form>
    </div>

    <!-- Simple iOS prompt -->
    <div id="ios-prompt">
        For fullscreen: Tap "Share" then "Add to Home Screen"
    </div>
</body>

</html>

<script>
    console.log('Hello');

    // Check if iOS device
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

    // Check if in standalone mode (launched from home screen)
    const isInStandaloneMode = () =>
        window.navigator.standalone ||
        window.matchMedia('(display-mode: standalone)').matches;

    // Show the prompt - note this blocks the ENTER button at the moment
    // Come back to this some other time...l
    // if (isIOS && !isInStandaloneMode()) {
    //     document.getElementById('ios-prompt').style.display = 'block';
    //     document.body.style.paddingBottom = '40px'; // Adjust padding to avoid overlap
    // }

    // Function to request fullscreen
    function toggleFullScreen() {

        const docElm = document.documentElement;
        if (!document.fullscreenElement &&
            !document.mozFullScreenElement &&
            !document.webkitFullscreenElement &&
            !document.msFullscreenElement) {

            if (docElm.requestFullscreen) {
                docElm.requestFullscreen();
            } else if (docElm.webkitRequestFullscreen) { // Safari
                docElm.webkitRequestFullscreen();
            } else if (docElm.mozRequestFullScreen) { // Firefox
                docElm.mozRequestFullScreen();
            } else if (docElm.msRequestFullscreen) { // IE/Edge
                docElm.msRequestFullscreen();
            }
        }
    }

    function checkForm() {
        console.log('checkForm:', document.gameform);
        if (document.gameform.name.value == "") {
            document.gameform.scrollIntoView();
            return false;
        }
        if (document.gameform.room.value == "") {
            document.gameform.name.scrollIntoView();
            return false;
        }
        if (document.gameform.avatar.value == "") {
            document.gameform.room.scrollIntoView();
            return false;
        }

        // Try to enter fullscreen when submitting the form
        try {
            // We need a user gesture to request fullscreen
            // This works because the form submission is triggered by a user action
            toggleFullScreen();

            // Give a moment for fullscreen to engage before submitting
            setTimeout(() => {
                return true;
            }, 300);
        } catch (err) {
            console.log('Fullscreen error:', err);
            // Continue with form submission even if fullscreen fails
            return true;
        }


        return true;
    }
    function selectAvatar(e) {
        console.log('select avatar:', e.target.parent);
        document.getElementById('avatar').value = e.target.id;
        document.getElementById('submit').scrollIntoView({ behavior: "smooth" });
        gsap.set("#gallerycontainer .gallery", { borderColor: "#051C55" });
        e.target.parentElement.style.borderColor = "darkorange";
    }
    const avatarlist = [12138118,
        12138231,
        12138743,
        12138846,
        12139963,
        12140600,
        12143538,
        12189343,
        12214366,
        12215207,
        12232806,
        12348050,
        12358126,
        12358607,
        12359578,
        12360465,
        12370419,
        12370830,
        12391847,
        12436639,
        12454847,
        12474909,
        12502935,
        12660677,
        12789062,
        12791500,
        13003915,
        13100182,
    ]
    avatarlist.forEach(element => {
        addAvatar(element);
    });
    function addAvatar(element) {
        // console.log('addAvatar:', element);
        const gallery = document.getElementById("gallerycontainer");
        const newAvatar = document.createElement('div');
        newAvatar.setAttribute('class', 'gallery');
        newAvatar.innerHTML = `
            <img id='${element}' src="/img/avatar-100/image-from-rawpixel-id-${element}-original.png">
        `;
        newAvatar.addEventListener("click", selectAvatar);
        gallery.appendChild(newAvatar);
    }
</script>